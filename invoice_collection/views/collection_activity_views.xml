<odoo>
    <record id="collection_activity_view_form" model="ir.ui.view">
        <field name="name">collection.activity.view.form</field>
        <field name="model">collection.activity</field>
        <field name="arch" type="xml">
            <form string="Collection Activity">
                <header>
                    <button name="btn_submit" states="draft" type="object" string="Submit" class="btn-primary" groups="invoice_collection.group_collection_sales_admin,base.group_system,invoice_collection.group_collection_top_manager"/>
                    <button name="btn_approve" type="object" string="Approve" class="btn-primary" attrs="{'invisible':['|',('user_can_approve','=',False), ('state','not in',['waiting_approval'])]}" groups="invoice_collection.group_collection_approver,base.group_system,invoice_collection.group_collection_top_manager" confirm="Approve?"/>
                    <button name="btn_reject" type="object" string="Reject"  attrs="{'invisible':['|',('user_can_approve','=',False), ('state','!=','waiting_approval')]}" groups="invoice_collection.group_collection_approver,base.group_system,invoice_collection.group_collection_top_manager" class="oe_highlight" confirm="Sure to reject?"/>
                    <button name="btn_draft" type="object" string="Set to Draft"  attrs="{'invisible':[('state','not in',['rejected'])]}" groups="invoice_collection.group_collection_sales_admin,base.group_system,invoice_collection.group_collection_top_manager"/>
                    <field name="show_start" invisible="1" />
                    <field name="is_user_collector" invisible="1" />
                    <button name="btn_start" type="object" string="Start" attrs="{'invisible':[('show_start','=',False)]}" groups="invoice_collection.group_collection_collector,base.group_system,invoice_collection.group_collection_top_manager" class="oe_highlight"/>
                    <button name="btn_proposed" type="object" string="Proposed"  attrs="{'invisible':[('state','not in',['approved'])]}" groups="invoice_collection.group_collection_accountant,base.group_system,invoice_collection.group_collection_top_manager" class="oe_highlight"/>
                    <button name="open_post_message_wizard" type="object" string="Post"  attrs="{'invisible':[('state','not in',['proposed'])]}" groups="invoice_collection.group_collection_accountant,base.group_system,invoice_collection.group_collection_top_manager" class="oe_highlight"/>
                    <button name="btn_to_review" type="object" string="Finish"  attrs="{'invisible':['|',('is_user_collector','=',False),('state','not in',['collecting'])]}" groups="invoice_collection.group_collection_collector,base.group_system,invoice_collection.group_collection_top_manager" class="oe_highlight" confirm="Finish?"/>
                    <button name="btn_done" type="object" string="Done"  attrs="{'invisible':[('state','not in',['finance_review'])]}" groups="invoice_collection.group_collection_reviewer,base.group_system,invoice_collection.group_collection_top_manager" class="oe_highlight" confirm="Sure to done?"/>
                    
                    <field name="state" widget="statusbar" statusbar_visible="draft,waiting_approval,approved" />
                </header>
                <sheet>
                    <h2><field name="name" attrs="{'invisible':[('id','=',False)],'readonly':[('state','not in',['draft'])]}"/></h2>
                    <group>
                        <group>
                            <field name="activity_date" attrs="{'readonly':[('state','not in',['draft'])]}"/>
                            <field name="collector_id" options="{'no_quick_create':True,'no_create':True}" attrs="{'readonly':[('state','not in',['draft'])]}"/>
                            <field name="highest_overdue_invoice" attrs="{'readonly':[('state','not in',['draft'])]}"/>
                        </group>
                        <group>
                            <field name="applicant_user_id" attrs="{'readonly':[('state','not in',['draft'])]}" />
                            <field name="create_date" readonly="1" />
                            <field name="gap_boolean_approve" group="invoice_collection.group_collection_top_manager"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Invoices">
                            <button name="btn_add_invoice_collection_ids" type="object" string="Select Invoice" class="btn-primary" attrs="{'invisible':[('state','not in',['draft','proposed'])]}"/>
                            <!-- <button name="btn_add_invoice" type="object" string="Add Invoice" class="btn-primary" groups="invoice_collection.group_collection_accountant,base.group_system,invoice_collection.group_collection_top_manager"  attrs="{'invisible':[('state','not in',['proposed'])]}"/> -->
                            <field name="line_ids" attrs="{'readonly':[('state','not in',['draft'])]}"/>
                        </page>
                        <page string="Unpaid Invoices">
                            <!-- <button name="btn_add_unpaid_invoice" type="object" string="Add Invoice" class="btn-primary" groups="invoice_collection.group_collection_accountant,base.group_system,invoice_collection.group_collection_top_manager"  attrs="{'invisible':[('state','not in',['proposed'])]}"/> -->
                            <field name="non_paid_line_ids" attrs="{'readonly':[('state','not in',['draft'])]}" context="{'invoice_payment_state':['not_paid','in_payment']}"/>
                        </page>
                        <page string="Paid Invoices">
                            <!-- <button name="btn_add_paid_invoice" type="object" string="Add Invoice" class="btn-primary" groups="invoice_collection.group_collection_accountant,base.group_system,invoice_collection.group_collection_top_manager"  attrs="{'invisible':[('state','not in',['proposed'])]}"/> -->
                            <field name="paid_line_ids" attrs="{'readonly':[('state','not in',['draft'])]}" context="{'invoice_payment_state':['paid']}"/>
                        </page>
                        <page string="E-Tax Invoice">
                            <button name="btn_add_tax_ids" type="object" string="Add Tax" class="btn-primary" groups="invoice_collection.group_collection_accountant,base.group_system,invoice_collection.group_collection_top_manager"  attrs="{'invisible':[('state','not in',['proposed'])]}"/>
                            <field name="e_tax_ids" attrs="{'readonly':[('state','not in',['draft'])]}">
                                <tree>
                                    <field name="e_tax_id"/>
                                    <field name="doc_status"/>
                                </tree>
                                <form>
                                    <group>
                                        <field name="e_tax_id"/>
                                        <field name="doc_status"/>
                                    </group>
                                </form>
                            </field>
                        </page>
                        <page string="Discount">
                            <field name="discount_ids"/>
                        </page>
                        <page string="Payments">
                            <field name="journal_ids">
                                <tree>
                                    <field name="name"/>
                                    <field name="ctx_amount_total" context="{'activity_id':id}"/>
                                </tree>
                            </field>
                        </page>
                        <page id="page_approval" string="Approvals">
                            <field name="user_can_approve" invisible="1"/>
                            <field name="approval_ids" readonly="1"/>
                            <group><field name="approved"/></group>
                        </page>
                        
                    </notebook>
                </sheet>
                <div class="oe_chatter">
				    <field name="message_follower_ids" widget="mail_followers"/>
				    <field name="activity_ids" widget="mail_activity"/>
				    <field name="message_ids" widget="mail_thread"/>
				</div>
            </form>
        </field>
    </record>

    <record id="collection_activity_view_tree" model="ir.ui.view">
        <field name="name">collection.activity.view.tree</field>
        <field name="model">collection.activity</field>
        <field name="arch" type="xml">
            <tree string="Collection Activity">
                <field name="name"/>
                <field name="applicant_user_id" optional="show"/>
                <field name="create_date" optional="show"/>
                <field name="activity_date"/>
                <field name="highest_overdue_invoice" optional="hide"/>
                <field name="collector_id" optional="show"/>
                <field name="state" optional="show"/>
                <field name="company_id" optional="hide"/>
                <field name="create_uid" optional="hide"/>
                <field name="write_uid" optional="hide"/>
            </tree>
        </field>
    </record>

    <record id="collection_activity_action" model="ir.actions.act_window">
        <field name="name">Collection Activity</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">collection.activity</field>
        <field name="view_mode">tree,form</field>
        <field name="view_id" eval="collection_activity_view_tree"/>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
            Create a new Collection Activity.
            </p>
        </field>
    </record>

    <record id="collection_activitiy_line_view_tree" model="ir.ui.view">
        <field name="name">collection.activity.line.view.tree</field>
        <field name="model">collection.activity.line</field>
        <field name="arch" type="xml">
            <tree decoration-danger="state=='finance_review' and doc_status==False">
                <field name="state" invisible="1" readonly="1"/>
                <field name="partner_id" options="{'no_quick_create':True,'no_create':True}"/>
                <field name="invoice_id" options="{'no_quick_create':True,'no_create':True}"/>
                <field name="invoice_date"/>
                <field name="invoice_origin"/>
                <field name="amount_total"/>
                <field name="pay_amount"/>
                <field name="amount_residual"/>
                <field name="payment_status"/>
                <field name="attachment"/>
                <field name="doc_status"/>
                <button name="btn_update_status" type="object" string="Update Status" class="btn-primary" groups="invoice_collection.group_collection_collector,base.group_system,invoice_collection.group_collection_top_manager" attrs="{'invisible':[('parent.state','not in',['collecting'])]}"/>
                <button name="btn_update_status" type="object" string="Update Status" class="btn-primary" groups="invoice_collection.group_collection_reviewer,base.group_system,invoice_collection.group_collection_top_manager" attrs="{'invisible':[('parent.state','not in',['finance_review'])]}"/>
                <button name="btn_update_status" type="object" string="Update Docs" class="btn-primary" groups="invoice_collection.group_collection_accountant,base.group_system,invoice_collection.group_collection_top_manager" attrs="{'invisible':[('parent.state','not in',['proposed'])]}"/>
            </tree>
        </field>
    </record>

    <record id="collection_activitiy_line_view_form_add_invoice" model="ir.ui.view">
        <field name="name">collection.activity.line.view.form.add.invoice</field>
        <field name="model">collection.activity.line</field>
        <field name="priority">200</field>
        <field name="arch" type="xml">
            <form string="">
                <sheet>
                    <group>
                        <group>
                            <field name="state" invisible="1"/>
                            <field name="partner_id" options="{'no_quick_create':True,'no_create':True}"/>
                            <field name="amount_total"/>
                            <field name="amount_residual"/>
                            <field name="payment_status" attrs="{'required':[('state','in',['collecting'])]}"/>
                            <field name="check_1" widget="boolean_button" options='{"terminology": "active"}' attrs="{'invisible':[('id','=',False)]}"/>
                        </group>
                        <group>
                            <field name="invoice_id" options="{'no_quick_create':True,'no_create':True}"/>
                            <field name="invoice_state"/>
                            <field name="pay_amount" attrs="{'required':[('state','in',['collecting','finance_review'])]}"/>
                            <field name="attachment"/>
                            <field name="doc_status"  attrs="{'required':[('state','in',['finance_review'])],'readonly':[('state','not in',['finance_review'])]}"/>
                            <field name="invoice_origin"/>
                            <field name="approved_by" readonly="1"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Payment Method">
                            <field name="payment_ids">
                                <tree editable="bottom">
                                    <field name="partner_id" invisible="1"/>
                                    <field name="allowed_discount_ids" invisible="1"/>
                                    <field name="journal_id"/>
                                    <field name="discount_id" domain="[('id','in', allowed_discount_ids),('partner_id','=',partner_id)]"  options="{'no_quick_create':True,'no_create':True}"/>
                                    <field name="amount"/>
                                </tree>
                            </field>
                        </page>
                         <page string="Note">
                            <field name="notes" attrs="{'required':[('doc_status','=','not_returned')],'readonly':[('state','not in',['collecting','finance_review'])]}"/>
                        </page>
                    </notebook>
                </sheet>
                <footer>
                    <button name="confirm" type="object" string="Save" class="oe_highlight"/>
                    <button string="Cancel" class="btn-default" special="cancel"/>
                </footer>
            </form>
        </field>
    </record>

    <record id="collection_activitiy_line_view_form_update_status" model="ir.ui.view">
        <field name="name">collection.activity.line.view.form.update.status</field>
        <field name="model">collection.activity.line</field>
        <field name="priority">100</field>
        <field name="arch" type="xml">
            <form string="">
                <sheet>
                    <group>
                        <group>
                            <field name="state" invisible="1"/>
                            <field name="partner_id" options="{'no_quick_create':True,'no_create':True}"/>
                            <field name="amount_total"/>
                            <field name="amount_residual"/>
                            <field name="payment_status" attrs="{'required':[('state','in',['collecting'])]}"/>
                            <field name="check_1" widget="boolean_button" options='{"terminology": "active"}' attrs="{'invisible':[('id','=',False)]}"/>
                        </group>
                        <group>
                            <field name="invoice_id" options="{'no_quick_create':True,'no_create':True}" readonly="1"/>
                            <field name="invoice_state"/>
                            <field name="pay_amount" attrs="{'required':[('state','in',['collecting','finance_review'])]}"/>
                            <field name="attachment"/>
                            <field name="doc_status" attrs="{'required':[('state','in',['finance_review'])],'readonly':[('state','not in',['finance_review'])]}"/>
                            <field name="invoice_origin"/>
                            <field name="approved_by" readonly="1"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Payment Method" name="payment_method">
                            <field name="payment_ids">
                                <tree editable="bottom">
                                    <field name="partner_id" invisible="1"/>
                                    <field name="allowed_discount_ids" invisible="1"/>
                                    <field name="journal_id"/>
                                    <field name="discount_id" domain="[('id','in', allowed_discount_ids),('partner_id','=',partner_id)]"  options="{'no_quick_create':True,'no_create':True}"/>
                                    <field name="amount"/>
                                </tree>
                            </field>
                        </page>
                        <page string="Note" name="notes">
                            <field name="notes" attrs="{'required':[('doc_status','=','not_returned')],'readonly':[('state','not in',['collecting','finance_review'])]}"/>
                        </page>
                    </notebook>
                </sheet>
                <footer>
                    <button name="confirm" type="object" string="Confirm" class="oe_highlight"/>
                </footer>
            </form>
        </field>
    </record>

    <record id="collection_activitiy_line_view_forms" model="ir.ui.view">
        <field name="name">collection.activity.line.view.forms</field>
        <field name="model">collection.activity.line</field>
        <field name="priority">10</field>
        <field name="arch" type="xml">
            <form string="">
                <sheet>
                    <group>
                        <group>
                            <field name="partner_id" options="{'no_quick_create':True,'no_create':True}"/>
                            <field name="amount_total" />
                            <field name="amount_residual" />
                            <field name="payment_status" attrs="{'invisible':[('parent.state','in',['draft'])]}"/>
                            <field name="check_1" widget="boolean_button" options='{"terminology": "active"}' attrs="{'invisible':[('id','=',False)]}"/>
                        </group>
                        <group>
                            <field name="invoice_id" options="{'no_quick_create':True,'no_create':True}" domain="[('type','=','out_invoice')]" />
                            <field name="invoice_state"/>
                            <field name="pay_amount" attrs="{'invisible':[('parent.state','in',['draft'])]}"/>
                            <field name="attachment" attrs="{'invisible':[('parent.state','in',['draft'])]}"/>
                            <field name="doc_status" attrs="{'invisible':[('parent.state','in',['draft'])]}"/>
                            <field name="invoice_origin"/>
                            <field name="approved_by" readonly="1"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Payment Method" attrs="{'invisible':[('parent.state','in',['draft'])]}">
                            <field name="payment_ids" >
                                <tree editable="bottom">
                                    <field name="partner_id" invisible="1"/>
                                    <field name="allowed_discount_ids" invisible="1"/>
                                    <field name="journal_id"/>
                                    <field name="discount_id" domain="[('id','in', allowed_discount_ids),('partner_id','=',partner_id)]"  options="{'no_quick_create':True,'no_create':True}"/>
                                    <field name="amount"/>
                                </tree>
                            </field>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <record id="collection_activity_etax_wizard_view_form_add_invoice" model="ir.ui.view">
        <field name="name">collection.activity.etax.wizard.view.form.add.invoice</field>
        <field name="model">collection.activity.etax.wizard</field>
        <field name="arch" type="xml">
            <form string="">
                <sheet>
                    <group>
                        <group>
                            <field name="partner_id" options="{'no_quick_create':True,'no_create':True}"/>
                            <field name="etax_ids" widget="many2many_tags" domain="[('doc_status','=','on_accountant')]" options="{'no_quick_create':True,'no_create':True}"/>
                        </group>
                    </group>
                </sheet>
                <footer>
                    <button name="confirm" type="object" string="Save" class="oe_highlight"/>
                    <button string="Cancel" class="btn-default" special="cancel"/>
                </footer>
            </form>
        </field>
    </record>

    <!-- Decoration for accountant -->
    <record id="collection_activitiy_line_view_tree_inherits" model="ir.ui.view">
        <field name="name">collection.activity.line.view.tree.inherits</field>
        <field name="inherit_id" ref="invoice_collection.collection_activitiy_line_view_tree" />
        <field name="groups_id" eval="[(4, ref('invoice_collection.group_collection_accountant'))]"/>
        <field name="model">collection.activity.line</field>
        <field name="arch" type="xml">
            <xpath expr="//tree" position="replace">
                <tree decoration-danger="check_1==False" decoration-primary="check_1==True" decoration-muted="state in ['ready','collecting','finance_review','done'] and check_1==False">
                    <field name="state" invisible="1" readonly="1"/>
                    <field name="partner_id" options="{'no_quick_create':True,'no_create':True}"/>
                    <field name="invoice_id" options="{'no_quick_create':True,'no_create':True}"/>
                    <field name="invoice_date"/>
                    <field name="invoice_origin"/>
                    <field name="amount_total"/>
                    <field name="pay_amount"/>
                    <field name="amount_residual"/>
                    <field name="payment_status"/>
                    <field name="attachment"/>
                    <field name="doc_status"/>
                    <field name="check_1" invisible="1"/>
                    <button name="btn_update_status" type="object" string="Update Status" class="btn-primary" groups="invoice_collection.group_collection_collector,base.group_system,invoice_collection.group_collection_top_manager"  attrs="{'invisible':[('parent.state','not in',['collecting'])]}"/>
                    <button name="btn_update_status" type="object" string="Update Status" class="btn-primary" groups="invoice_collection.group_collection_reviewer,base.group_system,invoice_collection.group_collection_top_manager"  attrs="{'invisible':[('parent.state','not in',['finance_review'])]}"/>
                    <button name="btn_update_status" type="object" string="Update Docs" class="btn-primary" groups="invoice_collection.group_collection_accountant,base.group_system,invoice_collection.group_collection_top_manager"  attrs="{'invisible':[('parent.state','not in',['proposed'])]}"/>
                </tree>
            </xpath>
        </field>
    </record>

    <!-- Decoration for Top Manager -->
    <record id="collection_activitiy_line_view_tree_inherits_manager" model="ir.ui.view">
        <field name="name">collection.activity.line.view.tree.inherits.manager</field>
        <field name="inherit_id" ref="invoice_collection.collection_activitiy_line_view_tree_inherits" />
        <field name="groups_id" eval="[(4, ref('invoice_collection.group_collection_top_manager'))]"/>
        <field name="model">collection.activity.line</field>
        <field name="arch" type="xml">
            <xpath expr="//tree" position="inside">
                <button name="btn_delete" type="object" string="Delete Docs" class="btn-primary" groups="base.group_system,invoice_collection.group_collection_top_manager" attrs="{'invisible':[('parent.state','not in',['proposed','approved'])]}"/>
            </xpath>
        </field>
    </record>

    <menuitem
      id="collector_menu"
      name="Collector"
      parent="account_accountant.menu_accounting"
      sequence="1"/>
    
    <menuitem
        id="menu_collection_activity"
        name="Collection"
        action="collection_activity_action"
        parent="collector_menu"
        sequence="2"/>
</odoo>