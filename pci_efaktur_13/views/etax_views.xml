<?xml version="1.0" encoding="utf-8"?>
<odoo>
	<data>
		<record id="etax_invoice_form_view" model="ir.ui.view">
            <field name="name">etax.invoice.form.view</field>
            <field name="model">etax.invoice</field>
            <field name="arch" type="xml">
                <form string="Efaktur Number">
	                <sheet string="Efaktur">
	                	<group>
		                    <group>
		                        <field name="name" attrs="{'readonly' : [('validated','=',True)]}"/>
								<field name="tax_number"/>
								<field name="downloaded"/>
								<field name="tax_payer"/>
		                    </group>
		                    <group>
		                    	<field name="validated" readonly="1"/>
			                    <field name="date_validated"/>
								<field name="upload_user" readonly="1"/>
		                    	
			                </group>
		                </group>
		                <group>
			                <group>
								<field name="invoice_id" domain="[('e_tax_invoice_id','=',False)]"/>
								<field name="invoice_date"/>
								<field name="is_vendor" readonly="1"/>
							</group> 
							<group>
	                            <field name="from_picking"/>                   
	                            <field name="related_picking_id"/> 
								<field name="company_id" readonly="1"/>
		                    </group>  
	                    </group>                
	                </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids" widget="mail_followers"/>
                        <field name="message_ids" widget="mail_thread"/>
                    </div>
                </form>
            </field>
        </record>

		<record id="etax_invoice_form_view_readonly" model="ir.ui.view">
            <field name="name">etax.invoice.form.view</field>
            <field name="model">etax.invoice</field>
            <field name="arch" type="xml">
                <form string="Efaktur Number">
	                <sheet string="Efaktur">
						<group>
							<label for="name"/>
							<h2><field name="name"/></h2>
						</group>
						<footer>
							<button name="apply_e_tax" string="Apply Tax Number" type="object" class="btn-primary"/>
							<button string="Cancel" class="btn-secondary" special="cancel" />
						</footer>
	                </sheet>
                </form>
            </field>
        </record>
        
        <record id="etax_invoice_form_view_group" model="ir.ui.view">
            <field name="model">etax.invoice</field>
            <field name="inherit_id" ref="etax_invoice_form_view" />
            <field name="groups_id" eval="[(6, 0, [ref('base.group_system')])]"/>
            <field name="arch" type="xml">
                <field name="validated" position="attributes">
                    <attribute name="readonly">False</attribute>
                </field>
            </field>
        </record>
        
        <record id="etax_invoice_tree_view" model="ir.ui.view">
            <field name="name">etax.invoice.tree.view</field>
            <field name="model">etax.invoice</field>
            <field name="arch" type="xml">
                <tree string="Efaktur Number">
                    <field name="name"/>
                    <field name="invoice_id"/>
                    <field name="invoice_date"/>
                    <field name="is_vendor" invisible="1"/>
                    <field name="from_picking" invisible="1"/>                   
					<field name="related_picking_id"/>
					<field name="downloaded"/>					
					<field name="validated"/>
					<field name="date_validated"/>
					<field name="upload_user" invisible="1"/>          
                </tree>
            </field>
        </record>
        
        <record id='etax_invoice_move_action' model='ir.actions.act_window'>
            <field name="name">e-Faktur</field>
            <field name="res_model">etax.invoice</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[('is_vendor','=',False)]</field>
            <field name="context">{'search_default_upload': True, 'search_default_used': True}</field>
            <field name="view_id" ref="etax_invoice_tree_view"/>
            <field name="help" type="html">
                <p class="oe_view_nocontent_create">
                    e-Faktur
                </p>    
            </field>
        </record>
        
        <menuitem id="menu_etax_invoice_action" name="e-Faktur"
            parent="account.menu_finance_receivables"
            action="etax_invoice_move_action" sequence="111"/>
            
      	<record id="account_move_efaktur_form_view" model="ir.ui.view">
            <field name="name">account.move.e.tax.invoice.form.view</field>
            <field name="model">account.move</field>
            <field name="inherit_id" ref="account.view_move_form"/>
            <field name="arch" type="xml">
				<xpath expr="//field[@name='ref']" position="after">
					<field name="partner_tax_digit" attrs="{'invisible': [('type','!=','out_invoice')]}"/>
					<field name="tax_number" invisible="1"/>
					<label for="e_tax_invoice_id" attrs="{'invisible': [('type','!=','out_invoice')]}"/>
					<div class="o_row" attrs="{'invisible': [('type','!=','out_invoice')]}">
						<field name="e_tax_invoice_id" readonly="1"/>
						
						<button name="action_cancel" string="Cancel" type="object" class="oe_inline btn-primary" attrs="{'invisible': ['|',('e_tax_invoice_id', '=',False),('state','!=','cancel')]}"/>
					</div>
					<field name="e_tax_vendor_bill" attrs="{'invisible': [('type','!=','in_invoice')]}"/>
				</xpath>
               	<field name="fiscal_position_id" position="after">
               		 <field name="e_tax_invoice_validated" invisible="1"/>
              	</field>
               	<field name="type" position="after">
               		<span style="font-size: 11px;" 
               		attrs="{'invisible': ['|', ('e_tax_invoice_validated', '=', True), ('e_tax_invoice_id', '=', False)]}"
               		class="label label-danger"><strong>e-Faktur: Not yet Uploaded</strong></span>
               		<span style="font-size: 11px;" 
               		attrs="{'invisible': [('e_tax_invoice_validated', '=', False)]}"
               		class="label label-success"><strong>e-Faktur: Uploaded</strong></span>
               	</field>
               	<button name="button_draft" position="after">
 					<button name="open_reset_message_wizard" string="Rev-Faktur" type="object"
					 attrs="{'invisible': ['|',('e_tax_invoice_id', '=',False),('type', '!=','out_invoice')]}"/>
					
               </button>
            </field>
        </record>
        
        <record id="account_move_etax_invoice_tree_view" model="ir.ui.view">
		    <field name="name">account.move.etax.invoice.tree.view</field>
            <field name="model">account.move</field>
		    <field name="inherit_id" ref="account.view_invoice_tree"/>
		    <field name="arch" type="xml">
		        <field name="partner_id" position="after"> 
		            <field name="e_tax_invoice_id"/>
		        </field>
		    </field>
		</record>
        
        <!-- <record id="system_group_view_e_tax_invoice_id" model="ir.ui.view">
		    <field name="name">system.group.view.etax.invoice.id</field>
            <field name="model">account.move</field>
		    <field name="inherit_id" ref="account_move_efaktur_form_view"/>
		    <field name="groups_id" eval="[(6, 0, [ref('base.group_system') ])]"/>
		    <field name="arch" type="xml">
		        <field name="e_tax_invoice_id" position="attributes"> 
		            <attribute name="readonly">1</attribute>
		        </field>
		    </field>
		</record> -->
		
		<!-- <record id="invoice_supplier_form_efaktur" model="ir.ui.view">
            <field name="name">account.move.supplier.form.etax.invoice</field>
            <field name="model">account.move</field>
            <field name="inherit_id" ref="account.view_move_form"/> 
            <field name="arch" type="xml">
            	<field name="partner_id" position="before">
            		<field name="tax_number" class='tax_ina' attrs="{'invisible': [('state', '!=','draft')], 'required': [('type', '=', 'in_move')]}"/>
            		<script type="text/javascript">
	                    $(document).ready(function(){
	                        if (typeof Cleave === 'function') {
	                            var selector = '.tax_ina';
	                            if ($(selector).length) {
	                                new Cleave(selector, {
	                                    numericOnly: true,
	                                    blocks: [3, 3, 2, 8],
	                                    delimiters: ['.', '-', '.'],
	                                });
	                            }
	                        }
	                    });
                    </script>
            		<field name="e_tax_invoice_id" attrs="{'invisible': [('state', '=','draft')]}" readonly="1"/>
            	</field>
            </field>
        </record> -->
        
        <record id='etax_invoice_purchase_action' model='ir.actions.act_window'>
            <field name="name">e-Faktur Purchase</field>
            <field name="res_model">etax.invoice</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[('is_vendor','=',True)]</field>
            <field name="context">{'search_default_upload': True, 'search_default_used': True}</field>
            <field name="view_id" ref="etax_invoice_tree_view"/>
            <field name="help" type="html">
                <p class="oe_view_nocontent_create">
                    e-Faktur
                </p>    
            </field>
        </record>
        
        <menuitem name="e-Faktur Purchase" id="etax_invoice_purchase_menu" action="etax_invoice_purchase_action"
          parent="account.menu_finance_payables" sequence="111"/>
          
       	<record id="view_etax_invoice_download" model="ir.ui.view">
            <field name="name">view.etax.invoice.download</field>
            <field name="model">etax.invoice</field>
            <field name="arch" type="xml">
            	<search string="Search">
            		<field name="invoice_id" string="Reference" filter_domain="['|','|',('invoice_id.name','ilike',self),('name','ilike',self),('related_picking_id','ilike',self)]" />
            		<field name="invoice_id" filter_domain="[('invoice_id.name','ilike',self)]"/>
                    <field name="name"/>
                    <field name="related_picking_id"/>
                	<group>
                		<filter string="NPWP" name="npwp" domain="[('npwp','=','True')]"/>	
	                    <separator/>
	                    <filter string="Downloaded" name="downloaded" domain="[('downloaded','=','True'),('validated','!=','True')]"/>	
	                    <separator/>
	                    <filter string="Not Uploaded" name="upload" domain="[('validated','=',False)]" />
	                    <separator/>
	                    <filter string="Code Used" name="used" domain="['|',('invoice_id','!=',False),('related_picking_id','!=',False)]"/>	
                    	<separator/>
                        <filter string="Invoice Date" name="invoicedate" context="{'group_by':'invoice_date'}"/>
                    </group>				            		
            	</search>
            </field>
       	</record>
	</data>
</odoo>