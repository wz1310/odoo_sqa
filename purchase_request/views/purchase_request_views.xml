<odoo>
    <record id="purchase_request_view_form" model="ir.ui.view">
        <field name="name">purchase.request.view.form</field>
        <field name="model">purchase.request</field>
        <field name="arch" type="xml">
            <form string="Purchase Request">
                <header>
                    <button name="btn_submit" states="draft" type="object" string="Submit" class="btn-primary"/>
                    <button name="btn_approve" type="object" string="Approve"  class="btn-primary" attrs="{'invisible':['|',('user_can_approve','=',False), ('state','not in',['waiting_approval'])]}"/>
                    <button name="open_reject_message_wizard" type="object" string="Reject"  attrs="{'invisible':['|',('user_can_approve','=',False), ('state','!=','waiting_approval')]}"/>
                    <button name="btn_draft" type="object" string="Set to Draft"  attrs="{'invisible':[('state','not in',['rejected'])]}"/>
                    <button name="open_po_wizard" type="object"  class="btn-primary" string="Create PO" attrs="{'invisible':[('state','not in',['approved'])]}" groups="purchase.group_purchase_user"/>
                    <button name="btn_close" type="object" string="Close PR" attrs="{'invisible':['|',('state','not in',['approved']),('status_pr','not in',['open'])]}" groups="purchase.group_purchase_user"/>
                    <field name="status_pr" invisible="1"/>
                    <field name="state" widget="statusbar" statusbar_visible="draft,waiting_approval,approved" />
                </header>
                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button class="oe_stat_button" type="object" name="open_po" icon="fa-usd">
                            <field string="Purchase Order" name="purchase_ids_count" widget="statinfo"/>
                        </button>
                    </div>
                    <h2><field name="name" attrs="{'invisible':[('id','=',False)],'readonly':[('state','not in',['draft'])]}" force_save="1"/></h2>
                    <group>
                        <group>
                            <field name="user_id" options="{'no_quick_create':True,'no_create':True}" readonly="1" force_save="1"/>
                            <field name="department_id"/>
                            <field name="date_order" attrs="{'readonly':[('state','not in',['draft'])]}"/>
                            <!--
                                # Modified by : SanQua
                                # At: 16/09/2021
                                # Purpose: When 'asset' checked, it will force 'purchase_order_type' become 'asset' and readonly.
                            -->
                            <field name="purchase_order_type" attrs="{'readonly':['|',('is_asset','=',True),('state','not in',['draft'])]}" required="1" force_save="1"/>
                        </group>
                        <group>
                            <field name="create_date"/>
                            <field name="is_asset" attrs="{'readonly':[('state','not in',['draft'])]}" context="{'default_purchase_order_type': purchase_order_type}"/>
                            <!-- <field name="is_asset" invisible="1"/> -->
                            <field name="company_id" options="{'no_quick_create':True,'no_create':True}" attrs="{'readonly':[('state','not in',['draft'])]}"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Purchase Request Line">
                            <field name="line_ids" context="{'default_pr_state':state,'default_is_asset':is_asset}">
                                <tree editable="bottom">
                                    <field name="is_editable" invisible="1"/>
                                    <field name="pr_state" invisible="1" />
                                    <field name="is_asset" invisible="1"/>
                                    <field name="product_id" options="{'no_quick_create':True,'no_create':True}" attrs="{'readonly':[('pr_state','!=','draft')]}" domain="[('is_asset','=',is_asset)]"/>
                                    <!-- <field name="product_id" options="{'no_quick_create':True,'no_create':True}" attrs="{'readonly':[('pr_state','!=','draft')]}"/> -->
                                    <field name="last_price" groups="purchase.group_purchase_manager"/>
                                    <field name="price_total" groups="purchase.group_purchase_manager"/>
                                    <field name="desc" attrs="{'readonly':[('is_editable','=',False)]}"/>
                                    <field name="qty" attrs="{'readonly':[('is_editable','=',False)]}"/>
                                    <field name="qty_released"/>
                                    <field name="uom_id" options="{'no_quick_create':True,'no_create':True}"/>
                                    <field name="current_stock"/>
                                    <field name="incoming_stock"/>
                                </tree>
                                <form>
                                    <sheet>
                                        <group>
                                            <group>
                                                <field name="is_editable" invisible="1"/>
                                                <field name="pr_state" invisible="1" />
                                                <field name="is_asset" invisible="1"/>
                                                <field name="product_id" options="{'no_quick_create':True,'no_create':True}" attrs="{'readonly':[('pr_state','!=','draft')]}" domain="[('is_asset','=',is_asset)]"/>
                                                <field name="desc" attrs="{'readonly':[('is_editable','=',False)]}"/>
                                            </group>
                                            <group>
                                                <field name="qty" attrs="{'readonly':[('is_editable','=',False)]}"/>
                                                <field name="qty_released"/>
                                                <field name="uom_id" options="{'no_quick_create':True,'no_create':True}"/>
                                                <field name="current_stock"/>
                                                <field name="incoming_stock"/>
                                            </group>
                                        </group>
                                        <group>
                                            <field name="non_asset_type" attrs="{'invisible':[('non_asset_type','=',False)]}"/>
                                        </group>
                                    </sheet>
                                </form>
                            </field>
                        </page>
                        <page id="page_approval" string="Approvals">
                            <field name="user_can_approve" invisible="1"/>
                            <field name="approval_ids" readonly="1"/>
                            <group><field name="approved"/></group>

                            <button string="Fetch Matrix" type="object" name="checking_approval_matrix" class="oe_highlight" groups="base.group_system" />
                        </page>
                        
                    </notebook>
                </sheet>
                <div class="oe_chatter">
				    <field name="message_follower_ids" widget="mail_followers"/>
				    <field name="activity_ids" widget="mail_activity"/>
				    <field name="message_ids" widget="mail_thread"/>
				</div>
            </form>
        </field>
    </record>

    <record id="purchase_request_view_tree" model="ir.ui.view">
        <field name="name">purchase.request.view.tree</field>
        <field name="model">purchase.request</field>
        <field name="arch" type="xml">
            <tree string="Purchase Request">
                <field name="name"/>
                <field name="date_order"/>
                <field name="company_id"/>
                <field name="user_id"/>
                <field name="state"/>
            </tree>
        </field>
    </record>

    <!-- Search View -->
    <record model="ir.ui.view" id="purchase_request_search">
        <field name="name">purchase.request.search</field>
        <field name="model">purchase.request</field>
        <field name="arch" type="xml">
            <search>
                <field name="name"/>
                <field name="date_order"/>
                <field name="company_id"/>
                <field name="user_id"/>
                <field name="state"/>
                <field name="status_pr"/>
            </search>
        </field>
    </record>

    <record id="purchase_request_action" model="ir.actions.act_window">
        <field name="name">Purchase Request</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">purchase.request</field>
        <field name="view_mode">tree,form</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
            Create a new Purchase request.
            </p>
        </field>
    </record>
    
    <menuitem
        id="menu_purchase_request"
        name="Purchase Request"
        action="purchase_request_action"
        parent="purchase.menu_procurement_management"
        sequence="2"/>
</odoo>